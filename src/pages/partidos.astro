---
import { Card } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import Layout from '@/layouts/Layout.astro';
import { obtenerPartidos } from '@/lib/partidos';

const partidos = await obtenerPartidos();
---

<Layout title="Programación de partidos" description="Programación de los proximos partidos de futbol">
    <Input
      type="text"
      placeholder="Buscar partidos..."
      id="searchInput"
      className="mb-8 bg-[#1E1E1E] border-none text-white placeholder:text-gray-400"
    />

    <div id="partidosContainer">
      {partidos.map((dia) => (
        <div class="mb-10 dia-container">
          <h2 class="text-xl font-semibold text-white mb-6">📅 {dia.dia}</h2>
          
          {dia.ligas.map((liga: any) => (
            <div class="mb-8 liga-container">
              <h3 class="text-lg font-medium text-gray-300 mb-4">🏆 {liga.nombre}</h3>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                {liga.partidos.map((partido: any) => (
                  <Card className="bg-[#17191d] border border-[#2c2c2c] rounded-xl hover:bg-[#252525] transition-colors partido-card"
                  style={{ borderRadius: '10px' }}
                  data-partido={partido.partido.toLowerCase()}>
                    <div class="p-5 text-gray-300">
                      <div class="flex items-center justify-between mb-2">
                        <h2 class="text-lg font-semibold text-white">⚽ {partido.partido}</h2>
                        <span class="text-sm text-gray-400">🕐 {partido.hora}</span>
                      </div>

                      <div class="border-t border-gray-700 pt-3">
                        <ul class="space-y-1 text-sm text-gray-400">
                          {partido.canales.map((canal: string) => (
                            <li>📺 {canal}</li>
                          ))}
                        </ul>
                      </div>
                    </div>
                  </Card>
                ))}
              </div>
            </div>
          ))}
        </div>
      ))}

      {partidos.length === 0 && (
        <p class="text-center text-gray-500 mt-10">No hay partidos para hoy.</p>
      )}
    </div>
</Layout>

<script>
  const searchInput = document.getElementById('searchInput');
  const partidoCards = document.querySelectorAll('.partido-card');
  const ligaContainers = document.querySelectorAll('.liga-container');
  const diaContainers = document.querySelectorAll('.dia-container');

  searchInput?.addEventListener('input', (e) => {
    const searchTerm = (e.target as HTMLInputElement).value.toLowerCase();

    // Ocultar/mostrar partidos
    partidoCards.forEach((card) => {
      const partido = (card as HTMLElement).dataset.partido || '';
      if (partido.includes(searchTerm)) {
        card.classList.remove('hidden');
      } else {
        card.classList.add('hidden');
      }
    });

    // Ocultar/mostrar ligas
    ligaContainers.forEach((liga) => {
      const partidosVisibles = liga.querySelectorAll('.partido-card:not(.hidden)').length;
      if (partidosVisibles === 0) {
        liga.classList.add('hidden');
      } else {
        liga.classList.remove('hidden');
      }
    });

    // Ocultar/mostrar días
    diaContainers.forEach((dia) => {
      const ligasVisibles = dia.querySelectorAll('.liga-container:not(.hidden)').length;
      if (ligasVisibles === 0) {
        dia.classList.add('hidden');
      } else {
        dia.classList.remove('hidden');
      }
    });
  });
</script>
